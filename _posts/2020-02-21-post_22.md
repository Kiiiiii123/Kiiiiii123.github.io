### Paper 5: Hierarchical Macro Strategy Model for MOBA Game AI (*Honour of Kings*)

<p align="center"><iframe width="560" height="315" src="https://v.qq.com/txp/iframe/player.html?vid=r0908hzeotw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>

### Abstract

- #### RTS games provide partially observable gaming environments, where agents interact with one another in an action space much larger than that of GO.


- #### Mastering RTS games requires both strong macro strategies and delicate micro level execution.


- #### We propose a novel learning-based Hierarchical Macro Strategy model for mastering MOBA games.

- #### Trained by the Hierarchical Macro Strategy model, agents explicitly make macro strategy decisions and further guide their micro level execution.

- #### Each of the agents makes independent strategy decisions, while simultaneously communicating with the allies through leveraging a novel imitated cross-agent communication mechanism.


### 1 Introduction

#### Game AI aims much more than robots playing games. Rather, games provide ideal environments that simulate the real world. AI researchers can conduct experiments in games, and `transfer successful AI ability to the real world`.

#### There are four major aspects that make RTS games much more difficult compared to GO:

1. #### Computational complexity. The computational complexity in terms of action space or state space of RTS games can be up to 10^20000, while the complexity of GO is about 10^250.

2. #### Multi-agent. Playing RTS games usually involves multiple agents. It is crucial for multiple agents to coordinate and cooporate.

3. #### Imperfect information. Many RTS games make use of fog of war to increase game uncertainty. When the game map is not fully observable, it is essential to consider gaming among one another.

4. #### Sparse and delayed rewards. RTS game length could often be larger than 20,000 frames, while each GO game is usually no more than 361 steps.

#### To master RTS games, players need to have strong skills in both `macro strategy operation and micro level execution`.  

#### Related work (important here):

- #### In recent study, much attention and attempts have been put to micro level execution.

- #### So far, OpenAI Five has made the most advanced progress. It was trained directly on micro level action space using PPO algorithms along with team rewards. It has shown strong teamfights skills （强大的团战技巧）and coordination comparable to top professional Dota2 teams. 

- #### OpenAI’s approach did not explicitly model macro strategy and tried to learn the entire game using micro level play. However, OpenAI Five was not able to defeat professional teams due to weakness in macro strategy management.

- #### Related work has also been done in explicit macro strategy operation, mostly focused on `navigation`. Navigation aims to provide reasonable destination spots and efficient routes for agents. Most related work in navigation used influence maps or potential field. Providing destination is the most important purpose of navigation in terms of macro strategy operation. `The ability to get to the right spots at right time makes essential difference between high level players and the others`. `Planning` has also been used in macro strategy operation. Although AHTN shows promising results in a mini-RTS game, it suffers from efficiency issue which makes it difficult to apply to full MOBA games directly.

- #### Previous work in macro strategy failed to provide complete solution:

  1. #### Reasoning macro strategy implicitly by learning upon micro level action space may be too difficult.

  2. #### Previous work on explicit macro strategy heavily relied on handcrafted equations for influence maps/potential fields computation and fusion.

  3. #### One of the most challenging problems in RTS game macro strategy operation is `coordination among multiple agents`. Previous work did not consider it in an explicit way.

  4. #### We have found that `modeling strategic phase`（战略时期划分） is crucial for MOBA game AI performance. Previous work did not consider this.

#### Teaching agents to learn macro strategy operation is challenging. We consider `supervised learning` to be a better scheme because high quality game replays can be fully leveraged to learn macro strategy along with corresponding execution samples. Note that macro strategy and execution learned using supervised learning can further `act as an initial policy` for reinforcement learning. 

#### We propose `Hierarchical Macro Strategy (HMS) model` - a general supervised learning framework for MOBA games such as Dota. HMS directly tackles with `computational complexity` and `multi-agent challenges` of MOBA games. More specifically, HMS is a hierarchical model which conducts macro strategy operation by `predicting attention on the game map under guidance of game phase modeling`. Thereby, HMS `reduces computational complexity by incorporating game knowledge`. Moreover, each HMS agent conducts learning with `a novel mechanism of communication with teammates agents` to cope with multi-agent challenge. 

### 2. Introduction to Multiplayer Online Battle Arena (MOBA) Games

#### 2.1 Game Description

#### As shown in the following figure, *Honour of Kings* players use left bottom steer button to control movements, while right bottom set of buttons to control skills. Surroundings are observable via the main screen. Players can also learn full map situation via the left top corner mini-map, where observable turrets, creeps, and heroes are displayed as thumbnails. Units are only observable either if they are allies’ units or if they are within a certain distance to allies’ units.

<p align="center">
<img src="/images/370.png"><br/>
</p>

![](C:\Users\24552\Desktop\370.png)

#### A conceptual map of MOBA is shown in the following figure. To master MOBA games, players need to have `both excellent macro strategy operation and proficient micro level execution`. Common macro strategies consist of opening（开局）, laning（兵线处理）, ganking（抓人）, ambushing（反蹲）, etc. Proficient micro level execution requires `high accuracy of control and deep understanding of damage and effects of skills`. Both macro strategy operation and micro level execution require mastery of timing to excel, which makes it extremely challenging and interesting.

<p align="center">
<img src="/images/371.png"><br/>
</p>

![](C:\Users\24552\Desktop\371.png)

#### 2.2 Computational Complexity

#### `Action space`: The normal game length of *Honour of Kings* is about 20 minutes, i.e., approximately 20,000 frames in terms of gamecore. At each frame, players make decision with tens of options, including movement button with 24 directions, and a few skill buttons with corresponding releasing position/directions. Even with significant discretization and simplification, as well as reaction time increased to 200ms, the action space is at magnitude of 10^1500.

#### `State space`: The resolution of *Honour of Kings* map is 130,000 by 130,000 pixels, and the diameter of each unit is 1,000. At each frame, each unit may have different status such as hit points, levels, gold. Again, the state space is at magnitude of 10^20000 with significant simplification. 

#### Comparison of action space and state space between MOBA and GO is listed in as below: 

<p align="center">
<img src="/images/372.png"><br/>
</p>

![](C:\Users\24552\Desktop\372.png)

#### 2.3 MOBA AI Macro Strategy Architecture

#### Our motivation of designing MOBA AI macro strategy model was `inspired from how human players make strategic decisions`. During MOBA games, experienced human players are fully aware of game phases. During each game phase, players pay attention to the game map and make corresponding decision on where to dispatch（派遣） the heroes. During the laning phase players tend to focus more on their own lanes rather than backing up allies, while during mid to late phases, players pay more attention to teamfight spots and pushing enemies’ base. 

